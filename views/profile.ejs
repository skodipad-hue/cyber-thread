<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            twitterBg: "#f5f9fc",
            twitterCard: "#ffffff",
            twitterBorder: "#e5eff6",
            twitterBlue: "#1d9bf0",
            twitterHover: "#e8f3ff",
            twitterText: "#0f172a",
            twitterMuted: "#64748b"
          }
        }
      }
    }
  </script>
</head>

<body class="bg-twitterBg text-twitterText min-h-screen font-sans antialiased">

<!-- BACK TO FEED -->
<a href="/users/<%= user.id %>/posts"
   class="fixed top-5 left-5 px-4 py-2 bg-twitterBlue text-white
          rounded-full font-semibold shadow-sm hover:bg-[#1a8cd8] transition">
  ‚Üê Back
</a>

<div class="max-w-3xl mx-auto mt-16 bg-twitterCard border border-twitterBorder rounded-2xl shadow-sm p-8">

  <!-- USER HEADER -->
  <div class="flex flex-col items-center mb-10">

    <!-- PROFILE IMAGE -->
    <div class="w-36 h-36 rounded-full border border-twitterBorder overflow-hidden bg-gray-100">
      <% if (user.profile_url) { %>
        <img src="<%= user.profile_url %>" class="w-full h-full object-cover">
      <% } else { %>
        <div class="w-full h-full flex items-center justify-center text-twitterMuted text-sm">
          No Image
        </div>
      <% } %>
    </div>

    <!-- UPLOAD PROFILE IMAGE -->
    <form action="/profile/<%= user.id %>/photo"
          method="POST"
          enctype="multipart/form-data"
          class="mt-4 w-full max-w-sm text-center">

      <div id="profileDrop"
           class="border border-dashed border-twitterBorder rounded-xl
                  px-4 py-4 cursor-pointer hover:bg-twitterHover transition">

        <p class="text-twitterBlue font-semibold">Upload Profile Image</p>
        <p class="text-twitterMuted text-sm">Click or drag & drop</p>

        <input type="file"
               name="profileImage"
               id="profileInput"
               accept="image/*"
               hidden>
      </div>

      <button
        class="mt-3 px-6 py-2 bg-twitterBlue text-white rounded-full
               font-semibold hover:bg-[#1a8cd8] transition">
        Save Photo
      </button>
    </form>

    <h1 class="text-2xl font-bold mt-6">
      @<%= user.username %>
    </h1>

    <p class="text-twitterMuted text-sm">
      <%= user.email %>
    </p>
  </div>

  <!-- BIO -->
  <div class="mb-10">
    <h2 class="font-semibold mb-2">Bio</h2>

    <% if (user.bio) { %>
      <p class="text-twitterText mb-3">
        <%= user.bio %>
      </p>
    <% } else { %>
      <p class="text-twitterMuted mb-3">No bio added yet</p>
    <% } %>

    <form action="/profile/<%= user.id %>" method="POST">
      <textarea
        name="bio"
        rows="3"
        class="w-full border border-twitterBorder rounded-xl p-3
               focus:outline-none focus:ring-2 focus:ring-twitterBlue"
        placeholder="Update your bio"></textarea>

      <button
        class="mt-2 px-4 py-2 bg-twitterBlue text-white
               rounded-full font-semibold hover:bg-[#1a8cd8] transition">
        Save Bio
      </button>
    </form>
  </div>

  <!-- CREATE POST -->
  <form action="/users/<%= user.id %>/posts" method="POST" class="mb-12">
    <textarea
      name="content"
      rows="3"
      class="w-full border border-twitterBorder rounded-xl p-4
             focus:outline-none focus:ring-2 focus:ring-twitterBlue mb-3"
      placeholder="What's on your mind?"
      required></textarea>

    <button
      class="px-6 py-2 bg-twitterBlue text-white rounded-full
             font-semibold hover:bg-[#1a8cd8] transition">
      Post
    </button>
  </form>

  <!-- POSTS LIST -->
  <% posts.forEach(post => { %>
    <div class="border border-twitterBorder rounded-2xl p-5 mb-6">

      <p class="text-twitterText mb-2">
        <%= post.content %>
      </p>

      <p class="text-twitterMuted text-xs mb-4">
        <%= post.timeAgo %>
      </p>

      <!-- EDIT -->
      <form action="/posts/<%= post.id %>?_method=PUT" method="POST" class="mb-3">
        <input type="hidden" name="userId" value="<%= user.id %>">

        <textarea
          name="content"
          rows="2"
          class="w-full border border-twitterBorder rounded-xl p-3
                 focus:outline-none focus:ring-2 focus:ring-twitterBlue mb-2"><%= post.content %></textarea>

        <button
          class="px-4 py-1.5 bg-yellow-400 text-black
                 rounded-full font-semibold hover:bg-yellow-300 transition">
          Edit
        </button>
      </form>

      <!-- DELETE -->
      <form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
        <input type="hidden" name="userId" value="<%= user.id %>">

        <button
          class="px-4 py-1.5 bg-red-500 text-white
                 rounded-full font-semibold hover:bg-red-400 transition">
          Delete
        </button>
      </form>

    </div>
  <% }) %>

</div>

<!-- DRAG & DROP SCRIPT -->
<script>
  const box = document.getElementById("profileDrop");
  const input = document.getElementById("profileInput");

  box.onclick = () => input.click();

  box.addEventListener("dragover", e => {
    e.preventDefault();
    box.classList.add("bg-twitterHover");
  });

  box.addEventListener("dragleave", () => {
    box.classList.remove("bg-twitterHover");
  });

  box.addEventListener("drop", e => {
    e.preventDefault();
    input.files = e.dataTransfer.files;
    box.classList.remove("bg-twitterHover");
  });
</script>

</body>
</html>
