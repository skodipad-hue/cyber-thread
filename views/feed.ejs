<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Feed</title>

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        cyberBg: "#0a0a0f",
        cyberCard: "#12121a",
        cyberGlow: "#00f6ff",
        cyberText: "#e5e7eb"
      },
      boxShadow: {
        glow: "0 0 25px rgba(0,246,255,0.25)",
        glowHover: "0 0 40px rgba(0,246,255,0.45)"
      }
    }
  }
}
</script>
</head>

<body class="bg-cyberBg text-cyberText font-mono min-h-screen">

<header class="flex justify-between items-center p-6 border-b border-cyberGlow/30 bg-cyberCard shadow-glow">
  <a href="/login" class="px-4 py-2 bg-red-500 text-black rounded-lg font-bold">
    Logout
  </a>

  <h1 class="text-3xl font-bold text-cyberGlow tracking-widest">
    CYBER THREADS
  </h1>

  <a href="/profile/<%= userId %>" class="px-4 py-2 bg-cyberGlow text-black rounded-lg font-bold">
    Profile
  </a>
</header>

<section
  class="max-w-7xl mx-auto mt-10 px-6 pb-20
         flex flex-wrap gap-8 justify-start items-start">

  <% posts.forEach(post => { %>

  <!-- POST CARD -->
  <div
    class="w-full sm:w-[48%] lg:w-[31%]"
    id="post-<%= post.id %>">

    <div class="w-full bg-cyberCard rounded-xl border border-cyberGlow/20 shadow-glow">

      <div class="block w-full text-left">

        <!-- HEADER -->
        <div class="flex justify-between items-start pt-4 pb-2">
          <h3 class="pl-5 text-cyberGlow font-bold text-lg">
            @<%= post.username %>
          </h3>
          <small class="pr-5 text-gray-400 text-xs whitespace-nowrap">
            <%= post.timeAgo %>
          </small>
        </div>

        <!-- CONTENT -->
        <div class="px-5 pb-4 pt-2">
          <p class="w-full text-left text-gray-300 whitespace-normal leading-relaxed break-words">
            <%= post.content %>
          </p>
        </div>

        <!-- ACTIONS -->
        <div class="flex justify-end px-5 pb-4">
          <button
            onclick="deletePost('<%= post.id %>')"
            class="text-red-400 hover:text-red-300 text-sm font-bold">
            Delete
          </button>
        </div>

      </div>

    </div>

  </div>

  <% }) %>

</section>

<script>
function deletePost(postId) {
  if (!confirm("Delete this post?")) return;

  fetch(`/posts/${postId}`, {
    method: "DELETE"
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const postEl = document.getElementById(`post-${postId}`);
      if (postEl) postEl.remove();
    } else {
      alert("Failed to delete post");
    }
  })
  .catch(() => alert("Error deleting post"));
}
</script>

</body>
</html>
